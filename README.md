[![js-semistandard-style](https://img.shields.io/badge/code%20style-semistandard-brightgreen.svg)](https://github.com/standard/semistandard)
[![Conventional Commits](https://img.shields.io/badge/Conventional%20Commits-1.0.0-yellow.svg)](https://conventionalcommits.org)

# About

A unified way to emit responses for [1C:Enterprise](https://www.1ci.com/developers/) platform.

Allows to generate both **sync** and **async** responses.

# Installation

```bash
npm install @skripio/response-emitter
```

# Usage

1.  Import `ResponseEmitter` class and instantiate emitter object. Emitter will create `div` element with id provided and attach it to `body` by default. That can be changed by passing `parentElementSelector` to the constructor.

```JavaScript
    import ResponseEmitter from '@skripio/response-emitter';
    const re = new ResponseEmitter({
        responseElementId: 'MyComponentName', 
        responseElementClass: 'response'
        });
```

1.  Call object methods to emit response message or to do auxiliary stuff.

# Response

**Skripio** `ResponseEmitter` prepares and emits response message object to [1C:Enterprise](https://www.1ci.com/developers/) platform.

Response message is guaranteed to have following structure:

```json
    { 
        "callback": "callback identifier", 
        "code": "response code", 
        "payload": "message payload" 
    }
```

where:

*   **callback** - contains callback identifier that allows to link function calls to responses when executing asynchronous code in `JS` from `1C:Enterprise`.
*   **code** - Response code.
*   **payload** - Message payload.

# Reference

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

*   [ResponseEmitter](#responseemitter)
    *   [Parameters](#parameters)
    *   [emitResponse](#emitresponse)
    *   [codes](#codes)
    *   [getUserMessage](#getusermessage)

## ResponseEmitter

**The response emitter object.**

### Parameters

*   `args` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Constructor arguments object.

    *   `args.responseElementId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Id that will be assigned to the response DOM element.
    *   `args.responseElementClass` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** CSS class name that will be assigned to the response DOM element.
    *   `args.parentElementSelector` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Selector of a DOM element that response DOM element will be attached to. (optional, default `'body'`)

### emitResponse

**Generates serialized response message object. Emits `click` event if required.**

#### Parameters

*   `id` **any** Any attribute to be placed against id key of the message object.
*   `code` **any** Any attribute to be placed against code key of the message object.
*   `payload` **any** Any attribute to be placed against payload key of the message object.
*   `click` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** If truthy then click event with serialized message object will be emitted. No event emitting otherwise. (optional, default `false`)

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Response message object serialized.

### codes

**`ResponseEmitter.codes` constants.**

### getUserMessage

**Generates 1C formatted notification message from phrases in different languages.**

#### Parameters

*   `phrases`  
*   `null-null` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Phrases Object that contains phrases in different languages where **key** must be language code and **value** contains phrase in that language.

#### Examples

```javascript
{
  ru: 'Сообщение на Русском языке.',
  en: 'Message in English language.'
}
```

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Formatted text or an empty string if object provided contains no keys with language codes listed in [ISO 639-1](https://en.wikipedia.org/wiki/List_of_ISO\_639-1\_codes).
